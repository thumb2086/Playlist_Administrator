class I18N:
    translations = {
        'zh-TW': {
            'app_title': "歌單管理員",
            'step_1_title': "步驟 1: 管理 Spotify 歌單連結",
            'add_url_btn': "新增 Spotify 連結",
            'remove_url_btn': "移除選取項目",
            'reset_status_btn': "重設更新狀態",
            'step_2_title': "步驟 2: 操作",
            'update_all_btn': "全部更新 (下載 & 同步)",
            'pause_btn': "暫停下載",
            'resume_btn': "繼續下載 (Resume)",
            'cancel_btn': "取消任務",
            'export_usb_btn': "選擇歌單匯出至 USB",
            'stats_title': "資料庫統計",
            'total_songs': "歌曲總數: {0} ({1})",
            'duplicate_songs': "重複歌曲: {0} 首",
            'space_saved': "已省下約: {0}",
            'recent_added': "最近新增: {0}",
            'log_title': "進度日誌",
            'loading': "讀取中...",
            'no_data': "(查無資料)",
            'error_no_name': "[錯誤] 無法從連結取得歌單名稱，請確認連結是否正確。",
            'duplicate_name_warning': "[提醒] 歌單名稱 '{0}' 已存在於連結: {1}",
            'duplicate_confirm_title': "重複名稱確認",
            'duplicate_confirm_msg': "歌單名稱 '{0}' 已經在清單中了，確定要新增第二個相同的嗎？",
            'added_playlist': "已新增歌單: {0}",
            'removed_url': "已移除連結: {0}",
            'auto_cleaned': "已自動清理重複或含多餘參數的歌單連結。",
            'reset_done': "已重設所有歌單的更新狀態，下次更新將重新掃描。",
            'cancel_confirm_title': "取消確認",
            'cancel_confirm_msg': "確定要取消目前的更新任務嗎？",
            'cancelling': "--- 正在取消任務，請稍候... ---",
            'task_cancelled': "任務已由使用者取消。",
            'update_start': "--- 開始更新流程 ---",
            'update_end': "--- 流程結束 ---",
            'error_critical_title': "嚴重錯誤",
            'error_critical': "發生嚴重錯誤: {0}",
            'stats_win_title': "更新統計報告",
            'export_win_title': "選擇要匯出的歌單",
            'export_win_label': "請勾選要匯出的歌單:",
            'export_all': "全選",
            'export_none': "全不選",
            'start_export_btn': "開始匯出所選歌單",
            'incomplete_warning_title': "警告",
            'incomplete_warning_msg': "以下歌單尚未下載完成，匯出至 USB 後可能會有缺歌：\n\n{0}\n\n確定要繼續匯出嗎？",
            'missing_songs': "缺 {0} 首",
            'local_complete': "本地已完成",
            'synced_today': "今日已同步",
            'wait_sync': "待同步",
            'wait_download': "待下載",
            'export_error': "匯出錯誤: {0}",
            'set_base_folder_btn': "設定主資料夾",
            'select_base_folder': "請選擇一個主資料夾來存放音樂、播放清單和匯出檔案",
            'base_folder_set_title': "主資料夾已設定",
            'base_folder_set_msg': "所有檔案將會儲存於: {0}",
            'base_folder_not_set_error': "您必須先設定一個主資料夾才能繼續。",
            'base_folder_changed': "主資料夾已變更。",
            # Core/Downloader strings
            'skip_no_urls': "沒有設定 Spotify 網址，跳過爬蟲步驟。",
            'skip_synced': "跳過已更新歌單: {0} (今天已同步)",
            'skip_invalid': "跳過無效網址: {0}",
            'scanning_pl': "\n正在掃描歌單 ID: {0}",
            'connecting_spotify': " -> 連線至 Spotify Embed...",
            'json_error': " -> JSON 解析錯誤: {0}",
            'html_fallback': " -> HTML Fallback: 找到 {0} 首歌曲",
            'saved_tracks': " -> 已儲存 {0} 首歌至 {1}",
            'warn_no_tracks': " -> 警告: 找不到歌曲，網頁結構可能已更改",
            'scrape_error': " -> 爬蟲錯誤: {0}",
            'no_pl_files': "Playlists 資料夾中沒有歌單檔案。",
            'scanning_lib': "正在掃描本地音樂庫...",
            'building_index': " -> 正在建立索引以便快速搜尋...",
            'indexed_songs': " -> 已索引 {0} 首歌曲",
            'analyzing_missing': "正在分析需下載歌曲 (共 {0} 個歌單)...",
            'task_stopped': "--- 已停止任務 ---",
            'rename_msg': "  [更名] {0} -> {1}",
            'rename_fail': "  [更名失敗] {0}",
            'stats_complete': "\n統計完成: 共 {0} 首新歌需下載",
            'dl_start': "--- 開始下載流程 ---",
            'dl_progress': "({0}/{1}, 剩 {2}) [{3}] 下載: {4}",
            'dl_rest': "[休息] 已成功下載 {0} 首，休息 15 秒以避免封鎖...",
            'lib_up_to_date': "太棒了! 您的音樂庫已是最新狀態，無需下載。",
            'update_complete': "\n更新完成!",
            'export_start': "\n=== 開始匯出至 USB 資料夾 ===",
            'no_pl_selected': "未選擇任何歌單!",
            'exporting_pl': "正在匯出 {0}...",
            'copy_error': "  複製錯誤: {0}",
            'exported_count': " -> 已匯出 {0}/{1} 檔案",
            'export_done_open': "\n匯出完成，正在開啟資料夾...",
            'open_dir_error': "[錯誤] 無法開啟資料夾: {0}",
            'ytdlp_warn': "[警告] {0}",
            'bot_detect': "[錯誤] YouTube 偵測為機器人或是地區限制。",
            'dl_fail': "[錯誤] {0}",
            'cookie_hint': "[提示] 使用 cookies.txt 協助",
            'searching': "正在搜尋: {0}...",
            'skip_premiere': "[跳過] 尚未首播。",
            'dl_module_error': "[錯誤] 下載模組異常: {0}",
            'lang_zh': "繁體中文",
            'lang_en': "English",
            'update_stats_title': "更新統計",
            'stats_playlists_scanned': "已掃描歌單數: {0}",
            'stats_songs_downloaded': "本地資料庫新增(下載)歌曲數: {0}",
            'stats_new_songs': "新下載歌曲",
            'stats_playlist_changes': "歌單變動明細 (與上次比較)",
            'stats_added_songs': "  + 新增: {0} 首",
            'stats_removed_songs': "  - 移除(或改名): {0} 首",
            'stats_no_change': "無變動",
            'playlist_update_summary': "歌單更新統計",
            'songs_updated': "首歌曲已更新",
            'no_songs_updated': "無歌曲更新",
        },
        'en': {
            'app_title': "Playlist Manager",
            'step_1_title': "Step 1: Manage Spotify Playlist URLs",
            'add_url_btn': "Add Spotify URL",
            'remove_url_btn': "Remove Selected",
            'reset_status_btn': "Reset Update Status",
            'step_2_title': "Step 2: Operations",
            'update_all_btn': "Update All (Download & Sync)",
            'pause_btn': "Pause Download",
            'resume_btn': "Resume Download",
            'cancel_btn': "Cancel Task",
            'export_usb_btn': "Export to USB",
            'stats_title': "Database Statistics",
            'total_songs': "Total Songs: {0} ({1})",
            'duplicate_songs': "Duplicates: {0}",
            'space_saved': "Space Saved: {0}",
            'recent_added': "Recently Added: {0}",
            'log_title': "Progress Log",
            'loading': "Loading...",
            'no_data': "(No data)",
            'error_no_name': "[Error] Failed to get playlist name. Check if the URL is correct.",
            'duplicate_name_warning': "[Notice] Playlist name '{0}' already exists at: {1}",
            'duplicate_confirm_title': "Duplicate Name Confirmation",
            'duplicate_confirm_msg': "Playlist '{0}' is already in the list. Are you sure you want to add it again?",
            'added_playlist': "Added playlist: {0}",
            'removed_url': "Removed URL: {0}",
            'auto_cleaned': "Automatically cleaned duplicate or malformed URLs.",
            'reset_done': "Reset all playlist statuses. Next update will rescan everything.",
            'cancel_confirm_title': "Cancel Confirmation",
            'cancel_confirm_msg': "Are you sure you want to cancel the current task?",
            'cancelling': "--- Cancelling task, please wait... ---",
            'task_cancelled': "Task cancelled by user.",
            'update_start': "--- Starting Update Flow ---",
            'update_end': "--- Flow Finished ---",
            'error_critical_title': "Critical Error",
            'error_critical': "Critical Error: {0}",
            'stats_win_title': "Update Statistics Report",
            'export_win_title': "Select Playlists to Export",
            'export_win_label': "Check playlists to export:",
            'export_all': "Select All",
            'export_none': "Deselect All",
            'start_export_btn': "Start Exporting",
            'incomplete_warning_title': "Warning",
            'incomplete_warning_msg': "The following playlists are not fully downloaded. Some songs might be missing after export:\n\n{0}\n\nContinue anyway?",
            'missing_songs': "missing {0}",
            'local_complete': "local complete",
            'synced_today': "synced today",
            'wait_sync': "pending sync",
            'wait_download': "pending download",
            'export_error': "Export Error: {0}",
            'set_base_folder_btn': "Set Base Folder",
            'select_base_folder': "Please select a base folder to store music, playlists, and exports",
            'base_folder_set_title': "Base Folder Set",
            'base_folder_set_msg': "All files will be saved in: {0}",
            'base_folder_not_set_error': "You must set a base folder to continue.",
            'base_folder_changed': "Base folder has been changed.",
            # Core/Downloader strings
            'skip_no_urls': "No Spotify URLs configured. Skipping scraper.",
            'skip_synced': "Skipping {0} (already synced today)",
            'skip_invalid': "Skipping invalid URL: {0}",
            'scanning_pl': "\nScanning playlist ID: {0}",
            'connecting_spotify': " -> Connecting to Spotify Embed...",
            'json_error': " -> JSON Parse Error: {0}",
            'html_fallback': " -> HTML Fallback: Found {0} songs",
            'saved_tracks': " -> Saved {0} tracks to {1}",
            'warn_no_tracks': " -> Warning: No songs found. Structure might have changed.",
            'scrape_error': " -> Scraper Error: {0}",
            'no_pl_files': "No playlist files found in Playlists folder.",
            'scanning_lib': "Scanning local library...",
            'building_index': " -> Building index for fast search...",
            'indexed_songs': " -> Indexed {0} songs",
            'analyzing_missing': "Analyzing missing songs (total {0} playlists)...",
            'task_stopped': "--- Task Stopped ---",
            'rename_msg': "  [Rename] {0} -> {1}",
            'rename_fail': "  [Rename Failed] {0}",
            'stats_complete': "\nScan complete: {0} new songs to download",
            'dl_start': "--- Starting Download Flow ---",
            'dl_progress': "({0}/{1}, {2} left) [{3}] Downloading: {4}",
            'dl_rest': "[Rest] {0} successful downloads. Resting 15s to avoid blocks...",
            'lib_up_to_date': "Awesome! Your library is up to date.",
            'update_complete': "\nUpdate Complete!",
            'export_start': "\n=== Starting USB Export ===",
            'no_pl_selected': "No playlists selected!",
            'exporting_pl': "Exporting {0}...",
            'copy_error': "  Copy Error: {0}",
            'exported_count': " -> Exported {0}/{1} files",
            'export_done_open': "\nExport complete. Opening folder...",
            'open_dir_error': "[Error] Cannot open folder: {0}",
            'ytdlp_warn': "[Warning] {0}",
            'bot_detect': "[Error] YouTube detected as bot or region restricted.",
            'dl_fail': "[Error] {0}",
            'cookie_hint': "[Notice] Helping with cookies.txt",
            'searching': "Searching: {0}...",
            'skip_premiere': "[Skip] Premiere not started.",
            'dl_module_error': "[Error] Downloader module error: {0}",
            'lang_zh': "繁體中文",
            'lang_en': "English",
            'update_stats_title': "Update Statistics",
            'stats_playlists_scanned': "Playlists scanned: {0}",
            'stats_songs_downloaded': "Songs downloaded: {0}",
            'stats_new_songs': "New Downloads",
            'stats_playlist_changes': "Playlist Changes (vs last sync)",
            'stats_added_songs': "  + Added: {0}",
            'stats_removed_songs': "  - Removed/Renamed: {0}",
            'stats_no_change': "No changes",
            'playlist_update_summary': "Playlist Update Summary",
            'songs_updated': "songs updated",
            'no_songs_updated': "no songs updated",
        },
    }

    current_lang = 'zh-TW'

    @classmethod
    def set_language(cls, lang):
        if lang in cls.translations:
            cls.current_lang = lang

    @classmethod
    def get(cls, key, *args):
        text = cls.translations.get(cls.current_lang, {}).get(key, key)
        if args:
            return text.format(*args)
        return text

def _(key, *args):
    return I18N.get(key, *args)
